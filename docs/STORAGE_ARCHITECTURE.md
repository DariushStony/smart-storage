# ğŸ—ï¸ StorageVault Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Your DK Application                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Component   â”‚  â”‚  Component   â”‚  â”‚  Component   â”‚          â”‚
â”‚  â”‚      A       â”‚  â”‚      B       â”‚  â”‚      C       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚         â”‚  import         â”‚  import         â”‚  import           â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚         â–¼                 â–¼                 â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   apps/dk/src/shared/utils/storage.ts            â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚  â€¢ userPrefsVault    â† User settings             â”‚          â”‚
â”‚  â”‚  â€¢ cacheVault        â† API responses             â”‚          â”‚
â”‚  â”‚  â€¢ sessionVault      â† Temporary state           â”‚          â”‚
â”‚  â”‚  â€¢ featureFlagsVault â† A/B tests                 â”‚          â”‚
â”‚  â”‚  â€¢ analyticsVault    â† Tracking                  â”‚          â”‚
â”‚  â”‚  â€¢ draftVault        â† Form auto-save            â”‚          â”‚
â”‚  â”‚  â€¢ growthbookVault   â† Experiments               â”‚          â”‚
â”‚  â”‚  â€¢ cartVault         â† Shopping cart             â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â”‚ uses                                     â”‚
â”‚                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   libs/utils/src/storage/index.ts                â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚  â€¢ defaultStorageVault                           â”‚          â”‚
â”‚  â”‚  â€¢ getStorageSlice()                             â”‚          â”‚
â”‚  â”‚  â€¢ StorageVault class                            â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚  Core Features:                                  â”‚          â”‚
â”‚  â”‚  â€¢ TTL expiration                                â”‚          â”‚
â”‚  â”‚  â€¢ Debounced writes                              â”‚          â”‚
â”‚  â”‚  â€¢ Automatic cleanup                             â”‚          â”‚
â”‚  â”‚  â€¢ SSR fallback                                  â”‚          â”‚
â”‚  â”‚  â€¢ Error handling                                â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚                         â”‚                            â”‚
â”‚         â–¼                         â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ localStorage â”‚         â”‚ sessionStorageâ”‚                    â”‚
â”‚  â”‚              â”‚         â”‚               â”‚                    â”‚
â”‚  â”‚ (Browser)    â”‚         â”‚ (Browser)     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚         â”‚                         â”‚                            â”‚
â”‚         â”‚ SSR? Use Memory         â”‚                            â”‚
â”‚         â–¼                         â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Map (Memory) â”‚         â”‚ Map (Memory)  â”‚                    â”‚
â”‚  â”‚              â”‚         â”‚               â”‚                    â”‚
â”‚  â”‚ (Server)     â”‚         â”‚ (Server)      â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Initialization Flow                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. App Starts                                                   â”‚
â”‚     â””â”€> apps/dk/src/pages/_app.jsx                              â”‚
â”‚                                                                  â”‚
â”‚  2. Calls initializeApp()                                        â”‚
â”‚     â””â”€> apps/dk/src/shared/services/init-app.ts                 â”‚
â”‚                                                                  â”‚
â”‚  3. Initializes Storage with Sentry Logger                       â”‚
â”‚     â””â”€> initializeStorageLogger({ log: sendLog })               â”‚
â”‚                                                                  â”‚
â”‚  4. âœ… Storage Ready!                                            â”‚
â”‚     â””â”€> All vaults now available throughout app                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Flow Example                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Component:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ import { userPrefsVault } from '@dk/.../storage';  â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ // Set theme                                       â”‚         â”‚
â”‚  â”‚ userPrefsVault.setItem('theme', 'dark');          â”‚â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                     â”‚     â”‚   â”‚
â”‚  â”‚ // Get theme                                       â”‚     â”‚   â”‚
â”‚  â”‚ const theme = userPrefsVault.getItem('theme');    â”‚â—„â”€â”€â”€â”€â”¤   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚                                                              â”‚   â”‚
â”‚  StorageVault:                                               â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚ 1. Validate key                                    â”‚     â”‚   â”‚
â”‚  â”‚ 2. Add to dirtyData (read-after-write)            â”‚     â”‚   â”‚
â”‚  â”‚ 3. Start debounce timer                            â”‚     â”‚   â”‚
â”‚  â”‚ 4. After 100ms â†’ Save to storage                  â”‚     â”‚   â”‚
â”‚  â”‚ 5. Setup beforeunload listener (auto-flush)       â”‚     â”‚   â”‚
â”‚  â”‚ 6. On error â†’ Log to Sentry                       â”‚     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚                               â”‚                              â”‚   â”‚
â”‚                               â–¼                              â”‚   â”‚
â”‚  localStorage:                                               â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚ Key: "DK_USER_PREFS"                               â”‚     â”‚   â”‚
â”‚  â”‚ Value: {                                           â”‚     â”‚   â”‚
â”‚  â”‚   "theme": {                                       â”‚     â”‚   â”‚
â”‚  â”‚     "value": "dark",                               â”‚     â”‚   â”‚
â”‚  â”‚     "expiry": null                                 â”‚     â”‚   â”‚
â”‚  â”‚   }                                                â”‚     â”‚   â”‚
â”‚  â”‚ }                                                  â”‚â—„â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vault Selection Guide                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Critical Data (Orders, Payments)                                â”‚
â”‚  â””â”€> userPrefsVault / cartVault (0ms debounce)                  â”‚
â”‚                                                                  â”‚
â”‚  User Settings (Theme, Language)                                 â”‚
â”‚  â””â”€> userPrefsVault (0ms debounce, permanent)                   â”‚
â”‚                                                                  â”‚
â”‚  API Cache (Products, Categories)                                â”‚
â”‚  â””â”€> cacheVault (200ms debounce, 5-10 min TTL)                  â”‚
â”‚                                                                  â”‚
â”‚  Temporary State (Wizard, Multi-step Forms)                      â”‚
â”‚  â””â”€> sessionVault (sessionStorage, cleared on tab close)        â”‚
â”‚                                                                  â”‚
â”‚  A/B Tests & Experiments                                         â”‚
â”‚  â””â”€> featureFlagsVault / growthbookVault (100ms debounce)       â”‚
â”‚                                                                  â”‚
â”‚  High-Frequency Updates (Analytics, Events)                      â”‚
â”‚  â””â”€> analyticsVault (500ms debounce)                            â”‚
â”‚                                                                  â”‚
â”‚  Form Auto-Save                                                  â”‚
â”‚  â””â”€> draftVault (1000ms debounce, 24h TTL)                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Singleton Pattern                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ComponentA.tsx:                                                 â”‚
â”‚  import { userPrefsVault } from '@dk/.../storage';              â”‚
â”‚  userPrefsVault.setItem('theme', 'dark');                       â”‚
â”‚                    â”‚                                             â”‚
â”‚                    â”‚ Same Instance                               â”‚
â”‚                    â–¼                                             â”‚
â”‚  ComponentB.tsx:                                                 â”‚
â”‚  import { userPrefsVault } from '@dk/.../storage';              â”‚
â”‚  const theme = userPrefsVault.getItem('theme'); // 'dark' âœ…    â”‚
â”‚                                                                  â”‚
â”‚  âœ… All imports share the same singleton instance               â”‚
â”‚  âœ… Changes in one place visible everywhere                     â”‚
â”‚  âœ… No need to pass down via props/context                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SSR vs Client Behavior                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Server-Side (SSR):                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ typeof window === 'undefined'                  â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ StorageVault uses:                             â”‚             â”‚
â”‚  â”‚ â€¢ Map<string, string> (in-memory)             â”‚             â”‚
â”‚  â”‚ â€¢ No persistence                              â”‚             â”‚
â”‚  â”‚ â€¢ Per-request isolation                       â”‚             â”‚
â”‚  â”‚ â€¢ No beforeunload listeners                   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  Client-Side (Browser):                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ typeof window !== 'undefined'                  â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ StorageVault uses:                             â”‚             â”‚
â”‚  â”‚ â€¢ localStorage / sessionStorage               â”‚             â”‚
â”‚  â”‚ â€¢ Full persistence                            â”‚             â”‚
â”‚  â”‚ â€¢ Shared across tabs (localStorage)           â”‚             â”‚
â”‚  â”‚ â€¢ Auto-flush on beforeunload                  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  Hydration Pattern:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ 1. Server renders with in-memory data          â”‚             â”‚
â”‚  â”‚ 2. Client loads and creates new instance       â”‚             â”‚
â”‚  â”‚ 3. useEffect hydrates client storage           â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ useEffect(() => {                              â”‚             â”‚
â”‚  â”‚   vault.setItem('data', serverData);           â”‚             â”‚
â”‚  â”‚ }, []);                                        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Takeaways

1. **Centralized Configuration**: All vaults pre-configured in `storage.ts`
2. **Singleton Pattern**: One instance per vault across entire app
3. **Auto-Initialization**: Setup once in `_app.jsx`, use everywhere
4. **SSR Safe**: Automatic fallback to in-memory storage
5. **Error Handling**: All errors logged to Sentry automatically
6. **Type Safe**: Full TypeScript support with generics
7. **Performance**: Debounced writes with read-after-write consistency

## Files Overview

```
apps/dk/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ _app.jsx                    â† Initialization (done!)
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ init-app.ts             â† Setup storage logger
â”‚       â”‚   â””â”€â”€ growthbook/
â”‚       â”‚       â””â”€â”€ cache.tsx           â† Example migration
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ storage.ts              â† 8 pre-configured vaults â­
â”‚           â”œâ”€â”€ STORAGE_GUIDE.md        â† Complete usage guide
â”‚           â””â”€â”€ ...
â”œâ”€â”€ STORAGE_SETUP_COMPLETE.md           â† Setup summary
â”œâ”€â”€ STORAGE_QUICK_REF.md                â† Quick reference
â””â”€â”€ MIGRATION_GUIDE.md                  â† Migration patterns

libs/utils/src/storage/
â”œâ”€â”€ index.ts                            â† Core implementation
â”œâ”€â”€ setup.ts                            â† Logger initialization
â”œâ”€â”€ README.md                           â† Full API docs
â””â”€â”€ docs/                               â† Additional documentation
```

---

**Everything is ready! Just import and use!** ğŸš€
